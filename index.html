<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Circl Chat - Ù…Ù†ØµØ© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        :root {
            --primary: #6366f1;
            --primary-light: #818cf8;
            --primary-dark: #4f46e5;
            --secondary: #ec4899;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --dark: #1f2937;
            --light: #f9fafb;
            --bronze: #cd7f32;
            --silver: #c0c0c0;
            --gold: #fbbf24;
            --diamond: #60a5fa;
            --king: #a855f7;
            --queen: #ec4899;
            --owner: #dc2626;
            --admin: #059669;
            --moderator: #3b82f6;
            --vip: #f59e0b;
            --therapist: #8b5cf6;
            --gradient-primary: linear-gradient(135deg, #6366f1 0%, #ec4899 100%);
            --gradient-secondary: linear-gradient(135deg, #fbbf24 0%, #f97316 100%);
            --gradient-therapist: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            --radius: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            --radius-2xl: 1.5rem;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #1f2937;
            line-height: 1.6;
            padding: 1rem;
        }

        .container {
            width: 100%;
            max-width: 1800px;
            height: 95vh;
            background: white;
            border-radius: var(--radius-2xl);
            overflow: hidden;
            box-shadow: var(--shadow-xl);
            display: flex;
            position: relative;
        }

        /* ========== Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ ========== */
        .sidebar {
            width: 350px;
            background: #111827;
            color: white;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            z-index: 100;
        }

        .user-profile {
            padding: 1.5rem;
            text-align: center;
            border-bottom: 1px solid #374151;
            background: rgba(255, 255, 255, 0.05);
        }

        .user-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            overflow: hidden;
            margin: 0 auto 1rem;
            border: 4px solid var(--primary);
            position: relative;
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .online-status {
            position: absolute;
            bottom: 8px;
            right: 8px;
            width: 20px;
            height: 20px;
            background: var(--success);
            border-radius: 50%;
            border: 3px solid #111827;
        }

        .username {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .user-role {
            display: inline-block;
            padding: 0.25rem 1rem;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .role-owner { background: var(--owner); }
        .role-admin { background: var(--admin); }
        .role-moderator { background: var(--moderator); }
        .role-vip { background: var(--vip); }
        .role-user { background: #6b7280; }

        .level-container {
            padding: 1rem 1.5rem;
            background: rgba(0, 0, 0, 0.2);
            border-bottom: 1px solid #374151;
        }

        .level-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .progress-bar {
            height: 8px;
            background: #374151;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-primary);
            transition: width 0.5s ease;
        }

        .rooms-section {
            padding: 1.5rem;
            flex: 1;
            overflow-y: auto;
        }

        .section-title {
            font-size: 0.875rem;
            color: #9ca3af;
            margin-bottom: 1rem;
            text-transform: uppercase;
            display: flex;
            justify-content: space-between;
        }

        .room-list {
            list-style: none;
        }

        .room-item {
            display: flex;
            align-items: center;
            padding: 0.875rem;
            border-radius: var(--radius-lg);
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }

        .room-item:hover {
            background: rgba(99, 102, 241, 0.1);
            border-color: rgba(99, 102, 241, 0.2);
        }

        .room-item.active {
            background: rgba(99, 102, 241, 0.15);
            border-right: 4px solid var(--primary);
        }

        .room-icon {
            margin-left: 0.75rem;
            font-size: 1.25rem;
            color: #9ca3af;
        }

        .room-item.active .room-icon {
            color: var(--primary);
        }

        .room-info {
            flex: 1;
        }

        .room-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .room-stats {
            display: flex;
            gap: 1rem;
            font-size: 0.75rem;
            color: #9ca3af;
        }

        .users-section {
            padding: 1.5rem;
            border-top: 1px solid #374151;
        }

        .user-list {
            list-style: none;
        }

        .user-list-item {
            display: flex;
            align-items: center;
            padding: 0.5rem;
            border-radius: var(--radius);
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .user-list-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .user-list-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            overflow: hidden;
            margin-left: 0.75rem;
        }

        .user-list-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* ========== Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ========== */
        .chat-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: linear-gradient(180deg, #f9fafb 0%, #f3f4f6 100%);
        }

        .chat-header {
            padding: 1.25rem 2rem;
            background: white;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .current-room-info {
            display: flex;
            align-items: center;
        }

        .room-avatar {
            width: 56px;
            height: 56px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 1rem;
            color: white;
            font-size: 1.5rem;
        }

        .room-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .room-desc {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .messages-container {
            flex: 1;
            padding: 1.5rem 2rem;
            overflow-y: auto;
        }

        .message {
            display: flex;
            margin-bottom: 1rem;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            overflow: hidden;
            margin-left: 1rem;
            flex-shrink: 0;
        }

        .message-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .message-content {
            flex: 1;
            background: white;
            padding: 1rem;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow);
            max-width: 70%;
        }

        .message.my-message {
            flex-direction: row-reverse;
        }

        .message.my-message .message-avatar {
            margin-left: 0;
            margin-right: 1rem;
        }

        .message.my-message .message-content {
            background: var(--gradient-primary);
            color: white;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .message-sender {
            font-weight: 600;
            font-size: 0.875rem;
        }

        .message-time {
            font-size: 0.75rem;
            color: #9ca3af;
        }

        .message.my-message .message-time {
            color: rgba(255, 255, 255, 0.8);
        }

        .message-text {
            line-height: 1.5;
            word-break: break-word;
        }

        .message-input-container {
            padding: 1.5rem 2rem;
            background: white;
            border-top: 1px solid #e5e7eb;
        }

        .input-wrapper {
            display: flex;
            align-items: center;
            background: #f9fafb;
            border-radius: var(--radius-xl);
            padding: 0.5rem;
            border: 1px solid #e5e7eb;
        }

        .message-input {
            flex: 1;
            border: none;
            background: transparent;
            padding: 0.75rem 1rem;
            font-family: 'Tajawal', sans-serif;
            font-size: 1rem;
            outline: none;
            color: #1f2937;
        }

        .send-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: none;
            background: var(--gradient-primary);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .send-btn:hover {
            transform: scale(1.05);
        }

        /* ========== Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© ========== */
        .auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .auth-box {
            background: white;
            padding: 2.5rem;
            border-radius: var(--radius-2xl);
            width: 90%;
            max-width: 500px;
            animation: popIn 0.3s ease;
            box-shadow: var(--shadow-xl);
        }

        @keyframes popIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .auth-title {
            text-align: center;
            margin-bottom: 2rem;
            font-size: 1.75rem;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .tabs {
            display: flex;
            margin-bottom: 2rem;
            border-bottom: 2px solid #e5e7eb;
        }

        .tab {
            flex: 1;
            text-align: center;
            padding: 1rem;
            cursor: pointer;
            font-weight: 600;
            color: #6b7280;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-control {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e5e7eb;
            border-radius: var(--radius-lg);
            font-family: 'Tajawal', sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .gender-select {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .gender-option {
            flex: 1;
            text-align: center;
            padding: 1rem;
            border: 2px solid #e5e7eb;
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .gender-option.selected {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.1);
        }

        .gender-option i {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .btn {
            padding: 1rem 1.5rem;
            border: none;
            border-radius: var(--radius-lg);
            font-family: 'Tajawal', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .google-btn {
            background: white;
            color: #374151;
            border: 1px solid #e5e7eb;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .google-btn:hover {
            background: #f9fafb;
        }

        /* ========== Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ========== */
        .admin-panel {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            z-index: 2000;
            overflow-y: auto;
            display: none;
        }

        .admin-panel.active {
            display: block;
        }

        .admin-header {
            padding: 1.5rem 2rem;
            background: #111827;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-content {
            padding: 2rem;
        }

        .admin-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 1rem;
        }

        .admin-tab {
            padding: 0.75rem 1.5rem;
            background: #f3f4f6;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 600;
        }

        .admin-tab.active {
            background: var(--gradient-primary);
            color: white;
        }

        /* ========== Ù†Ø§ÙØ°Ø© VIP ========== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1500;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-box {
            background: white;
            padding: 2rem;
            border-radius: var(--radius-xl);
            width: 90%;
            max-width: 400px;
            animation: popIn 0.3s ease;
        }

        /* ========== Ø§Ù„ØªØ¬Ø§ÙˆØ¨ Ù…Ø¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª ========== */
        @media (max-width: 1200px) {
            .container {
                height: 100vh;
                max-width: 100%;
                border-radius: 0;
            }
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                position: absolute;
                left: -100%;
                width: 85%;
                height: 100%;
            }
            
            .sidebar.active {
                left: 0;
            }
            
            .chat-header {
                padding: 1rem;
            }
            
            .messages-container {
                padding: 1rem;
            }
            
            .message-input-container {
                padding: 1rem;
            }
            
            .message-content {
                max-width: 85%;
            }
            
            .auth-box {
                padding: 1.5rem;
                margin: 1rem;
            }
        }

        /* ========== ØªØ®ØµÙŠØµ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± ========== */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a1a1a1;
        }

        .dark-scrollbar::-webkit-scrollbar-track {
            background: #374151;
        }

        .dark-scrollbar::-webkit-scrollbar-thumb {
            background: #4b5563;
        }

        /* ========== Ø¥Ø¶Ø§ÙØ§Øª ========== */
        .typing-indicator {
            padding: 0.5rem 1rem;
            background: white;
            border-radius: var(--radius-lg);
            margin: 0 2rem;
            box-shadow: var(--shadow);
            display: none;
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-right: 0.25rem;
        }

        .badge-owner { background: var(--owner); color: white; }
        .badge-admin { background: var(--admin); color: white; }
        .badge-moderator { background: var(--moderator); color: white; }
        .badge-vip { background: var(--vip); color: white; }
        .badge-verified { color: #3b82f6; }

        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--success);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            z-index: 3000;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { top: -100px; opacity: 0; }
            to { top: 20px; opacity: 1; }
        }

        .notification.error { background: var(--danger); }
        .notification.warning { background: var(--warning); }
        .notification.info { background: var(--info); }
    </style>
</head>
<body>
    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© -->
    <div class="auth-overlay" id="authOverlay">
        <div class="auth-box">
            <div class="auth-title">ğŸš€ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Circl Chat</div>
            
            <div class="tabs">
                <div class="tab active" data-tab="login">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</div>
                <div class="tab" data-tab="register">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</div>
            </div>
            
            <!-- Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
            <div id="loginForm">
                <div class="form-group">
                    <input type="text" class="form-control" id="loginUsername" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" autocomplete="username">
                </div>
                
                <div class="form-group">
                    <input type="password" class="form-control" id="loginPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" autocomplete="current-password">
                </div>
                
                <button class="btn btn-primary" id="loginBtn">Ø¯Ø®ÙˆÙ„</button>
                
                <div style="text-align: center; margin: 1.5rem 0; color: #6b7280;">Ø£Ùˆ</div>
                
                <button class="btn google-btn" id="googleLoginBtn">
                    <i class="fab fa-google"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø­Ø³Ø§Ø¨ Google
                </button>
            </div>
            
            <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ -->
            <div id="registerForm" style="display: none;">
                <div class="form-group">
                    <input type="text" class="form-control" id="registerUsername" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" autocomplete="username">
                </div>
                
                <div class="form-group">
                    <input type="password" class="form-control" id="registerPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" autocomplete="new-password">
                </div>
                
                <div class="form-group">
                    <div class="gender-select">
                        <div class="gender-option selected" data-gender="male">
                            <i class="fas fa-mars"></i>
                            <div>Ø°ÙƒØ±</div>
                        </div>
                        <div class="gender-option" data-gender="female">
                            <i class="fas fa-venus"></i>
                            <div>Ø£Ù†Ø«Ù‰</div>
                        </div>
                    </div>
                </div>
                
                <button class="btn btn-primary" id="registerBtn">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
                
                <div style="text-align: center; margin: 1.5rem 0; color: #6b7280;">Ø£Ùˆ</div>
                
                <button class="btn google-btn" id="googleRegisterBtn">
                    <i class="fab fa-google"></i> Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ø­Ø³Ø§Ø¨ Google
                </button>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© VIP -->
    <div class="modal-overlay" id="vipModal">
        <div class="modal-box">
            <h3 style="text-align: center; margin-bottom: 1rem;">
                <i class="fas fa-crown" style="color: var(--vip);"></i>
                ØºØ±ÙØ© VIP
            </h3>
            <p style="text-align: center; margin-bottom: 1.5rem; color: #6b7280;">
                Ù‡Ø°Ù‡ Ø§Ù„ØºØ±ÙØ© Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù…Ù…ÙŠØ²ÙŠÙ†. ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:
            </p>
            <input type="password" class="form-control" id="vipPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" style="margin-bottom: 1rem;">
            <div style="display: flex; gap: 0.5rem;">
                <button class="btn" style="flex: 1; background: #f3f4f6;" onclick="closeVipModal()">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn btn-primary" style="flex: 1;" onclick="enterVipRoom()">Ø¯Ø®ÙˆÙ„</button>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© -->
    <div class="admin-panel" id="adminPanel">
        <div class="admin-header">
            <h2>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>
            <button class="btn" onclick="closeAdminPanel()" style="background: #ef4444; color: white;">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
        
        <div class="admin-content">
            <div class="admin-tabs">
                <div class="admin-tab active" data-admin-tab="users">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>
                <div class="admin-tab" data-admin-tab="rooms">Ø§Ù„ØºØ±Ù</div>
                <div class="admin-tab" data-admin-tab="reports">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</div>
            </div>
            
            <div id="adminUsers">
                <div style="margin-bottom: 1rem;">
                    <input type="text" class="form-control" placeholder="Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù…..." id="adminUserSearch">
                </div>
                <div id="adminUsersList"></div>
            </div>
            
            <div id="adminRooms" style="display: none;">
                <div id="adminRoomsList"></div>
            </div>
            
            <div id="adminReports" style="display: none;">
                <p>Ù‚Ø±ÙŠØ¨Ø§Ù‹: ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…</p>
            </div>
        </div>
    </div>

    <!-- ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <div class="container" id="chatContainer" style="display: none;">
        <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ -->
        <div class="sidebar dark-scrollbar" id="sidebar">
            <div class="user-profile">
                <div class="user-avatar">
                    <img id="userAvatarImg" src="" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
                    <div class="online-status"></div>
                </div>
                <div class="username">
                    <span id="userDisplayName"></span>
                    <i class="fas fa-check-circle badge-verified" id="verifiedBadge" style="display: none;"></i>
                </div>
                <div class="user-role" id="userRole">Ù…Ø³ØªØ®Ø¯Ù…</div>
            </div>
            
            <div class="level-container">
                <div class="level-info">
                    <div style="color: #9ca3af; font-size: 0.875rem;">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ <span id="userLevel">1</span></div>
                    <div style="font-weight: 600; font-size: 0.875rem;" id="userRank">Ù…Ø¨ØªØ¯Ø¦</div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="levelProgress" style="width: 0%;"></div>
                </div>
                <div style="display: flex; justify-content: space-between; font-size: 0.75rem; color: #9ca3af;">
                    <span id="currentXP">0 XP</span>
                    <span id="nextLevelXP">100 XP</span>
                </div>
            </div>
            
            <div class="rooms-section dark-scrollbar">
                <div class="section-title">
                    <span>Ø§Ù„ØºØ±Ù Ø§Ù„Ù…ØªØ§Ø­Ø©</span>
                    <span id="roomsCount">0</span>
                </div>
                <ul class="room-list" id="roomList"></ul>
            </div>
            
            <div class="users-section dark-scrollbar">
                <div class="section-title">
                    <span>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„Ù†Ø´Ø·ÙˆÙ†</span>
                    <span id="onlineCount">0</span>
                </div>
                <ul class="user-list" id="userList"></ul>
            </div>
        </div>
        
        <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
        <div class="chat-main">
            <div class="chat-header">
                <div class="current-room-info">
                    <div class="room-avatar">
                        <i class="fas fa-users" id="roomIcon"></i>
                    </div>
                    <div>
                        <div class="room-title" id="currentRoomTitle">Ø¹Ø§Ù…</div>
                        <div class="room-desc" id="currentRoomDesc">Ø§Ù„ØºØ±ÙØ© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„Ø¬Ù…ÙŠØ¹</div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 0.5rem;">
                    <button class="btn" id="mobileMenuBtn" style="display: none;">
                        <i class="fas fa-bars"></i>
                    </button>
                    <button class="btn btn-primary" id="adminBtn" style="display: none;">
                        <i class="fas fa-cog"></i> Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
                    </button>
                </div>
            </div>
            
            <div class="messages-container" id="messagesContainer">
                <div style="text-align: center; padding: 3rem; color: #6b7280;">
                    <i class="fas fa-comments" style="font-size: 4rem; opacity: 0.3; margin-bottom: 1rem;"></i>
                    <h3 style="margin-bottom: 0.5rem; color: #111827;">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ!</h3>
                    <p>Ø§Ø®ØªØ± ØºØ±ÙØ© Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</p>
                </div>
            </div>
            
            <div class="typing-indicator" id="typingIndicator">
                <span style="color: #6b7280; font-size: 0.875rem;">
                    <i class="fas fa-pencil-alt" style="margin-left: 0.5rem;"></i>
                    <span id="typingUser">Ù…Ø³ØªØ®Ø¯Ù…</span> ÙŠÙƒØªØ¨ Ø§Ù„Ø¢Ù†...
                </span>
            </div>
            
            <div class="message-input-container">
                <div class="input-wrapper">
                    <input type="text" class="message-input" id="messageInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..." autocomplete="off">
                    <button class="send-btn" id="sendBtn">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========== Ù†Ø¸Ø§Ù… Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ==========
        class Database {
            constructor() {
                this.dbName = 'circl_chat_db';
                this.version = 4;
                this.db = null;
                this.init();
            }

            async init() {
                return new Promise((resolve, reject) => {
                    const request = indexedDB.open(this.dbName, this.version);
                    
                    request.onerror = () => reject(request.error);
                    request.onsuccess = () => {
                        this.db = request.result;
                        this.setupDefaultData();
                        resolve();
                    };
                    
                    request.onupgradeneeded = (event) => {
                        const db = event.target.result;
                        
                        // Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„
                        if (!db.objectStoreNames.contains('users')) {
                            const usersStore = db.createObjectStore('users', { keyPath: 'id' });
                            usersStore.createIndex('username', 'username', { unique: true });
                            usersStore.createIndex('email', 'email', { unique: true });
                            usersStore.createIndex('role', 'role', { unique: false });
                        }
                        
                        if (!db.objectStoreNames.contains('rooms')) {
                            const roomsStore = db.createObjectStore('rooms', { keyPath: 'id' });
                            roomsStore.createIndex('name', 'name', { unique: true });
                            roomsStore.createIndex('type', 'type', { unique: false });
                        }
                        
                        if (!db.objectStoreNames.contains('messages')) {
                            const messagesStore = db.createObjectStore('messages', { keyPath: 'id' });
                            messagesStore.createIndex('roomId', 'roomId', { unique: false });
                            messagesStore.createIndex('timestamp', 'timestamp', { unique: false });
                        }
                        
                        if (!db.objectStoreNames.contains('tickets')) {
                            const ticketsStore = db.createObjectStore('tickets', { keyPath: 'id' });
                            ticketsStore.createIndex('userId', 'userId', { unique: false });
                            ticketsStore.createIndex('status', 'status', { unique: false });
                        }
                        
                        if (!db.objectStoreNames.contains('levels')) {
                            const levelsStore = db.createObjectStore('levels', { keyPath: 'userId' });
                        }
                    };
                });
            }

            async setupDefaultData() {
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ
                const owner = await this.getUser('mvnnooo');
                if (!owner) {
                    await this.addUser({
                        id: 'owner-001',
                        username: 'mvnnooo',
                        email: 'owner@circlchat.com',
                        password: 'mmmmnnnn11',
                        role: 'owner',
                        gender: 'male',
                        avatar: `https://api.dicebear.com/7.x/avataaars/svg?seed=mvnnooo&backgroundColor=dc2626`,
                        verified: true,
                        points: 10000,
                        level: 100,
                        joinDate: new Date().toISOString(),
                        permissions: ['all']
                    });
                }

                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„ØºØ±Ù Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
                const rooms = await this.getAllRooms();
                if (rooms.length === 0) {
                    const defaultRooms = [
                        {
                            id: 'room-1',
                            name: 'Ø¹Ø§Ù…',
                            description: 'Ø§Ù„ØºØ±ÙØ© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„Ø¬Ù…ÙŠØ¹',
                            type: 'public',
                            icon: 'fa-users',
                            maxUsers: 500,
                            order: 1,
                            createdBy: 'system'
                        },
                        {
                            id: 'room-2',
                            name: 'VIP',
                            description: 'ØºØ±ÙØ© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù…Ù…ÙŠØ²ÙŠÙ†',
                            type: 'vip',
                            icon: 'fa-crown',
                            maxUsers: 100,
                            order: 2,
                            createdBy: 'system',
                            password: '1218'
                        },
                        {
                            id: 'room-3',
                            name: 'Ø«Ø±Ø§Ø¨ÙŠØ³Øª',
                            description: 'Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ù†ÙØ³ÙŠ Ù…Ø¹ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ',
                            type: 'therapist',
                            icon: 'fa-user-md',
                            maxUsers: 50,
                            order: 3,
                            createdBy: 'system',
                            isBot: true
                        },
                        {
                            id: 'room-4',
                            name: 'Ù…ØµØ± ğŸ‡ªğŸ‡¬',
                            description: 'ØºØ±ÙØ© Ù…ØµØ± Ø§Ù„Ù…Ù…ÙŠØ²Ø©',
                            type: 'public',
                            icon: 'fa-flag',
                            maxUsers: 300,
                            order: 4,
                            createdBy: 'system'
                        },
                        {
                            id: 'room-5',
                            name: 'Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨',
                            description: 'Ù…Ù†Ø§Ù‚Ø´Ø© Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ ÙˆØ§Ù„ØªØ­Ø¯ÙŠØ§Øª',
                            type: 'public',
                            icon: 'fa-gamepad',
                            maxUsers: 200,
                            order: 5,
                            createdBy: 'system'
                        }
                    ];

                    for (const room of defaultRooms) {
                        await this.addRoom(room);
                    }
                }
            }

            // ========== Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ==========
            async addUser(user) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['users'], 'readwrite');
                    const store = transaction.objectStore('users');
                    const request = store.add(user);
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }

            async getUser(username) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['users'], 'readonly');
                    const store = transaction.objectStore('users');
                    const index = store.index('username');
                    const request = index.get(username);
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }

            async getUserById(userId) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['users'], 'readonly');
                    const store = transaction.objectStore('users');
                    const request = store.get(userId);
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }

            async getAllUsers() {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['users'], 'readonly');
                    const store = transaction.objectStore('users');
                    const request = store.getAll();
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }

            async updateUser(userId, updates) {
                return new Promise(async (resolve, reject) => {
                    const user = await this.getUserById(userId);
                    if (!user) {
                        reject(new Error('Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯'));
                        return;
                    }
                    
                    const updatedUser = { ...user, ...updates };
                    const transaction = this.db.transaction(['users'], 'readwrite');
                    const store = transaction.objectStore('users');
                    const request = store.put(updatedUser);
                    
                    request.onsuccess = () => resolve(updatedUser);
                    request.onerror = () => reject(request.error);
                });
            }

            // ========== Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØºØ±Ù ==========
            async addRoom(room) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['rooms'], 'readwrite');
                    const store = transaction.objectStore('rooms');
                    const request = store.add(room);
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }

            async getRoom(roomId) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['rooms'], 'readonly');
                    const store = transaction.objectStore('rooms');
                    const request = store.get(roomId);
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }

            async getAllRooms() {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['rooms'], 'readonly');
                    const store = transaction.objectStore('rooms');
                    const request = store.getAll();
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }

            async updateRoom(roomId, updates) {
                return new Promise(async (resolve, reject) => {
                    const room = await this.getRoom(roomId);
                    if (!room) {
                        reject(new Error('Ø§Ù„ØºØ±ÙØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©'));
                        return;
                    }
                    
                    const updatedRoom = { ...room, ...updates };
                    const transaction = this.db.transaction(['rooms'], 'readwrite');
                    const store = transaction.objectStore('rooms');
                    const request = store.put(updatedRoom);
                    
                    request.onsuccess = () => resolve(updatedRoom);
                    request.onerror = () => reject(request.error);
                });
            }

            // ========== Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ==========
            async addMessage(message) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['messages'], 'readwrite');
                    const store = transaction.objectStore('messages');
                    const request = store.add(message);
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }

            async getRoomMessages(roomId, limit = 100) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['messages'], 'readonly');
                    const store = transaction.objectStore('messages');
                    const index = store.index('roomId');
                    const request = index.getAll(roomId);
                    
                    request.onsuccess = () => {
                        const messages = request.result
                            .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
                            .slice(0, limit)
                            .reverse();
                        resolve(messages);
                    };
                    request.onerror = () => reject(request.error);
                });
            }

            // ========== Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØªØ°Ø§ÙƒØ± (Ù„Ù„Ø«ÙŠØ±Ø§Ø¨ÙŠØ³Øª) ==========
            async createTicket(userId, issue) {
                const ticket = {
                    id: `ticket-${Date.now()}`,
                    userId,
                    issue,
                    status: 'open',
                    createdAt: new Date().toISOString(),
                    responses: []
                };
                
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['tickets'], 'readwrite');
                    const store = transaction.objectStore('tickets');
                    const request = store.add(ticket);
                    
                    request.onsuccess = () => resolve(ticket);
                    request.onerror = () => reject(request.error);
                });
            }

            async getTodayTicket(userId) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['tickets'], 'readonly');
                    const store = transaction.objectStore('tickets');
                    const index = store.index('userId');
                    const request = index.getAll(userId);
                    
                    request.onsuccess = () => {
                        const tickets = request.result;
                        const today = new Date().toDateString();
                        const todayTicket = tickets.find(ticket => 
                            new Date(ticket.createdAt).toDateString() === today
                        );
                        resolve(todayTicket);
                    };
                    request.onerror = () => reject(request.error);
                });
            }

            async addTicketResponse(ticketId, response) {
                return new Promise(async (resolve, reject) => {
                    const ticket = await this.getTicket(ticketId);
                    if (!ticket) {
                        reject(new Error('Ø§Ù„ØªØ°ÙƒØ±Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©'));
                        return;
                    }
                    
                    ticket.responses.push({
                        ...response,
                        timestamp: new Date().toISOString()
                    });
                    
                    const transaction = this.db.transaction(['tickets'], 'readwrite');
                    const store = transaction.objectStore('tickets');
                    const request = store.put(ticket);
                    
                    request.onsuccess = () => resolve(ticket);
                    request.onerror = () => reject(request.error);
                });
            }

            async getTicket(ticketId) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['tickets'], 'readonly');
                    const store = transaction.objectStore('tickets');
                    const request = store.get(ticketId);
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }
        }

        // ========== Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù„Ù„Ø«ÙŠØ±Ø§Ø¨ÙŠØ³Øª ==========
        class TherapistAI {
            constructor() {
                this.responses = {
                    greetings: [
                        "Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ Ù„Ù„Ø¯Ø¹Ù… Ø§Ù„Ù†ÙØ³ÙŠ. ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ",
                        "Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø¬Ù„Ø³Ø© Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ù†ÙØ³ÙŠ. Ø£Ù†Ø§ Ù‡Ù†Ø§ Ù„Ø£Ø³ØªÙ…Ø¹ Ø¥Ù„ÙŠÙƒ ÙˆØ£Ù‚Ø¯Ù… Ù„Ùƒ Ø§Ù„Ø¯Ø¹Ù….",
                        "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ! Ø£Ù†Ø§ Ø¨ÙˆØª Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ù†ÙØ³ÙŠØŒ Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø£ÙŠ Ø´ÙŠØ¡ ØªØ±ÙŠØ¯ Ø§Ù„Ø­Ø¯ÙŠØ« Ø¹Ù†Ù‡ØŸ"
                    ],
                    stress: [
                        "Ø£ÙÙ‡Ù… Ø£Ù†Ùƒ ØªØ´Ø¹Ø± Ø¨Ø§Ù„ØªÙˆØªØ±. Ø­Ø§ÙˆÙ„ Ø£Ù† ØªØ£Ø®Ø° Ù†ÙØ³Ø§Ù‹ Ø¹Ù…ÙŠÙ‚Ø§Ù‹ ÙˆØªØ°ÙƒØ± Ø£Ù† ÙƒÙ„ Ø´ÙŠØ¡ Ù…Ø¤Ù‚Øª.",
                        "Ø§Ù„ØªÙˆØªØ± Ø¬Ø²Ø¡ Ù…Ù† Ø§Ù„Ø­ÙŠØ§Ø©ØŒ ÙˆÙ„ÙƒÙ† ÙŠÙ…ÙƒÙ†Ù†Ø§ Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹Ù‡. Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø´Ø§Ø±ÙƒØ© Ù…Ø§ ÙŠÙ‚Ù„Ù‚ÙƒØŸ",
                        "Ø¬Ø±Ø¨ ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„ØªÙ†ÙØ³ Ø§Ù„Ø¹Ù…ÙŠÙ‚: Ø´Ù‡ÙŠÙ‚ Ù„Ù…Ø¯Ø© 4 Ø«ÙˆØ§Ù†ØŒ Ø§Ø­Ø¨Ø³ Ù„Ù…Ø¯Ø© 7ØŒ Ø²ÙÙŠØ± Ù„Ù…Ø¯Ø© 8."
                    ],
                    anxiety: [
                        "Ø§Ù„Ù‚Ù„Ù‚ Ø·Ø¨ÙŠØ¹ÙŠØŒ Ù„ÙƒÙ† Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙƒÙˆÙ† Ù…ÙØ±Ø·Ø§Ù‹ ÙÙ‡Ùˆ ÙŠØ­ØªØ§Ø¬ Ù„Ù„Ø§Ù‡ØªÙ…Ø§Ù…. Ù‡Ù„ ØªØ­Ø¯Ø«Øª Ù…Ø¹ Ø£Ø­Ø¯ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø´Ø¹ÙˆØ±ØŸ",
                        "Ø¬Ø±Ø¨ ÙƒØªØ§Ø¨Ø© Ù…Ø§ ÙŠÙ‚Ù„Ù‚Ùƒ Ø¹Ù„Ù‰ ÙˆØ±Ù‚Ø©ØŒ Ù‡Ø°Ø§ ÙŠØ³Ø§Ø¹Ø¯ ÙÙŠ ØªÙ†Ø¸ÙŠÙ… Ø§Ù„Ø£ÙÙƒØ§Ø± ÙˆØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù‚Ù„Ù‚.",
                        "ØªØ°ÙƒØ± Ø£Ù† Ù…Ø¹Ø¸Ù… Ø§Ù„Ø£Ø´ÙŠØ§Ø¡ Ø§Ù„ØªÙŠ ØªÙ‚Ù„Ù‚Ù†Ø§ Ù„Ø§ ØªØ­Ø¯Ø« Ø£Ø¨Ø¯Ø§Ù‹. Ø±ÙƒØ² Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§Ø¶Ø±."
                    ],
                    depression: [
                        "Ø£Ù†Ø§ Ù‡Ù†Ø§ Ù„Ø£Ø³ØªÙ…Ø¹ Ø¥Ù„ÙŠÙƒ. Ø§Ù„Ø§ÙƒØªØ¦Ø§Ø¨ Ù„ÙŠØ³ Ø¶Ø¹ÙØ§Ù‹ØŒ ÙˆÙ‡Ùˆ Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø¹Ù„Ø§Ø¬.",
                        "Ù‡Ù„ ÙÙƒØ±Øª ÙÙŠ Ø§Ù„ØªØ­Ø¯Ø« Ù…Ø¹ Ù…Ø®ØªØµ Ù†ÙØ³ÙŠØŸ Ù‡Ø°Ø§ Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ù…ÙÙŠØ¯Ø§Ù‹ Ø¬Ø¯Ø§Ù‹.",
                        "Ø­Ø§ÙˆÙ„ Ø£Ù† ØªØ¨Ø¯Ø£ Ø¨Ù†Ø´Ø§Ø·Ø§Øª ØµØºÙŠØ±Ø© ÙŠÙˆÙ…ÙŠØ§Ù‹ØŒ Ø­ØªÙ‰ Ù„Ùˆ ÙƒØ§Ù†Øª Ø¨Ø³ÙŠØ·Ø© Ù…Ø«Ù„ Ø§Ù„Ù…Ø´ÙŠ Ù‚Ù„ÙŠÙ„Ø§Ù‹."
                    ],
                    general: [
                        "Ø´ÙƒØ±Ø§Ù‹ Ù„Ù…Ø´Ø§Ø±ÙƒØªÙƒ Ù‡Ø°Ø§ Ù…Ø¹ÙŠ. ØªØ°ÙƒØ± Ø£Ù† Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø¹Ù„Ø§Ù…Ø© Ù‚ÙˆØ©ØŒ Ù„ÙŠØ³ Ø¶Ø¹Ù.",
                        "Ø£Ù†Øª Ù„Ø³Øª ÙˆØ­Ø¯Ùƒ ÙÙŠ Ù‡Ø°Ø§. ÙƒØ«ÙŠØ±ÙˆÙ† Ù…Ø±ÙˆØ§ Ø¨ØªØ¬Ø§Ø±Ø¨ Ù…Ø´Ø§Ø¨Ù‡Ø© ÙˆØªØ®Ø·ÙˆÙ‡Ø§.",
                        "Ø§Ù„Ø±Ø¹Ø§ÙŠØ© Ø§Ù„Ø°Ø§ØªÙŠØ© Ù…Ù‡Ù…Ø©. Ø®ØµØµ ÙˆÙ‚ØªØ§Ù‹ Ù„Ù†ÙØ³Ùƒ ÙƒÙ„ ÙŠÙˆÙ…."
                    ]
                };
            }

            async generateResponse(userMessage) {
                // Ù…Ø­Ø§ÙƒØ§Ø© Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù„ØºØ© Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ©
                await new Promise(resolve => setTimeout(resolve, 800));
                
                const message = userMessage.toLowerCase();
                let category = 'general';
                
                if (message.includes('Ù…Ø±Ø­Ø¨Ø§') || message.includes('Ø§Ù‡Ù„Ø§') || message.includes('Ø§Ù„Ø³Ù„Ø§Ù…')) {
                    category = 'greetings';
                } else if (message.includes('ØªÙˆØªØ±') || message.includes('Ø¶ØºØ·') || message.includes('Ù…ØªÙˆØªØ±')) {
                    category = 'stress';
                } else if (message.includes('Ù‚Ù„Ù‚') || message.includes('Ø®ÙˆÙ') || message.includes('Ù‚Ù„Ù‚Ø§Ù†')) {
                    category = 'anxiety';
                } else if (message.includes('Ø§ÙƒØªØ¦Ø§Ø¨') || message.includes('Ø­Ø²Ù†') || message.includes('Ù…ÙƒØªØ¦Ø¨')) {
                    category = 'depression';
                }
                
                const responses = this.responses[category];
                return responses[Math.floor(Math.random() * responses.length)];
            }
        }

        // ========== Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ==========
        class ChatApp {
            constructor() {
                this.db = new Database();
                this.therapistAI = new TherapistAI();
                this.currentUser = null;
                this.currentRoom = null;
                this.socket = null;
                this.typingUsers = new Set();
                this.typingTimeout = null;
                this.onlineUsers = new Map();
                this.initialize();
            }

            async initialize() {
                try {
                    await this.db.init();
                    this.setupEventListeners();
                    this.checkAutoLogin();
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:', error);
                    this.showNotification('Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚', 'error');
                }
            }

            setupEventListeners() {
                // ØªØ¨Ø¯ÙŠÙ„ ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        e.preventDefault();
                        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                        tab.classList.add('active');
                        
                        const tabId = tab.dataset.tab;
                        if (tabId === 'login') {
                            document.getElementById('loginForm').style.display = 'block';
                            document.getElementById('registerForm').style.display = 'none';
                        } else {
                            document.getElementById('loginForm').style.display = 'none';
                            document.getElementById('registerForm').style.display = 'block';
                        }
                    });
                });

                // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¬Ù†Ø³
                document.querySelectorAll('.gender-option').forEach(option => {
                    option.addEventListener('click', () => {
                        document.querySelectorAll('.gender-option').forEach(opt => opt.classList.remove('selected'));
                        option.classList.add('selected');
                    });
                });

                // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                document.getElementById('loginBtn').addEventListener('click', () => this.login());
                document.getElementById('loginUsername').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.login();
                });
                document.getElementById('loginPassword').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.login();
                });

                // Ø§Ù„ØªØ³Ø¬ÙŠÙ„
                document.getElementById('registerBtn').addEventListener('click', () => this.register());
                document.getElementById('registerUsername').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.register();
                });
                document.getElementById('registerPassword').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.register();
                });

                // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù€ Google (Ù…Ø­Ø§ÙƒØ§Ø©)
                document.getElementById('googleLoginBtn').addEventListener('click', () => this.googleLogin());
                document.getElementById('googleRegisterBtn').addEventListener('click', () => this.googleRegister());

                // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
                document.getElementById('sendBtn').addEventListener('click', () => this.sendMessage());
                document.getElementById('messageInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.sendMessage();
                    }
                });

                // Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù†Ø´Ø·Ø©
                document.getElementById('messageInput').addEventListener('input', () => {
                    this.signalTyping();
                });

                // Ø²Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ù„Ø¬ÙˆØ§Ù„
                document.getElementById('mobileMenuBtn').addEventListener('click', () => {
                    document.getElementById('sidebar').classList.toggle('active');
                });

                // Ø²Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
                document.getElementById('adminBtn').addEventListener('click', () => {
                    this.openAdminPanel();
                });

                // ØªØ¨ÙˆÙŠØ¨Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
                document.querySelectorAll('.admin-tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
                        tab.classList.add('active');
                        
                        const tabId = tab.dataset.adminTab;
                        document.querySelectorAll('#adminUsers, #adminRooms, #adminReports')
                            .forEach(el => el.style.display = 'none');
                        document.getElementById(`admin${tabId.charAt(0).toUpperCase() + tabId.slice(1)}`).style.display = 'block';
                        
                        if (tabId === 'users') this.loadAdminUsers();
                        else if (tabId === 'rooms') this.loadAdminRooms();
                    });
                });

                // Ø¨Ø­Ø« Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
                document.getElementById('adminUserSearch').addEventListener('input', (e) => {
                    this.filterAdminUsers(e.target.value);
                });

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ù†Ø§ÙØ°Ø©
                window.addEventListener('resize', () => {
                    this.handleResponsiveDesign();
                });
            }

            checkAutoLogin() {
                const savedUser = localStorage.getItem('circl_current_user');
                if (savedUser) {
                    try {
                        this.currentUser = JSON.parse(savedUser);
                        this.startApp();
                    } catch (error) {
                        localStorage.removeItem('circl_current_user');
                    }
                }
            }

            async login() {
                const username = document.getElementById('loginUsername').value.trim();
                const password = document.getElementById('loginPassword').value;

                if (!username || !password) {
                    this.showNotification('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', 'error');
                    return;
                }

                try {
                    const user = await this.db.getUser(username);
                    if (!user) {
                        this.showNotification('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
                        return;
                    }

                    if (user.password !== password) {
                        this.showNotification('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
                        return;
                    }

                    await this.completeLogin(user);
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:', error);
                    this.showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„', 'error');
                }
            }

            async register() {
                const username = document.getElementById('registerUsername').value.trim();
                const password = document.getElementById('registerPassword').value;
                const gender = document.querySelector('.gender-option.selected')?.dataset.gender;

                if (!username || !password) {
                    this.showNotification('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', 'error');
                    return;
                }

                if (!gender) {
                    this.showNotification('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¬Ù†Ø³', 'error');
                    return;
                }

                if (password.length < 6) {
                    this.showNotification('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'error');
                    return;
                }

                try {
                    const existingUser = await this.db.getUser(username);
                    if (existingUser) {
                        this.showNotification('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„', 'error');
                        return;
                    }

                    const newUser = {
                        id: `user-${Date.now()}`,
                        username,
                        email: `${username}@circlchat.com`,
                        password,
                        role: 'user',
                        gender,
                        avatar: `https://api.dicebear.com/7.x/avataaars/svg?seed=${username}&backgroundColor=6366f1`,
                        verified: false,
                        points: 100,
                        level: 1,
                        joinDate: new Date().toISOString(),
                        permissions: []
                    };

                    await this.db.addUser(newUser);
                    await this.completeLogin(newUser);
                    this.showNotification('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„:', error);
                    this.showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨', 'error');
                }
            }

            async googleLogin() {
                this.showNotification('Ø¬Ø§Ø±Ù ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø­Ø³Ø§Ø¨ Google...', 'info');
                
                // Ù…Ø­Ø§ÙƒØ§Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù€ Google
                setTimeout(async () => {
                    const username = `user_${Math.floor(Math.random() * 10000)}`;
                    const googleUser = {
                        id: `google-${Date.now()}`,
                        username,
                        email: `${username}@gmail.com`,
                        password: 'google_auth',
                        role: 'user',
                        gender: Math.random() > 0.5 ? 'male' : 'female',
                        avatar: `https://api.dicebear.com/7.x/avataaars/svg?seed=google${Date.now()}`,
                        verified: true,
                        points: 200,
                        level: 1,
                        joinDate: new Date().toISOString(),
                        permissions: [],
                        isGoogle: true
                    };

                    try {
                        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
                        const existingUser = await this.db.getUser(username);
                        if (!existingUser) {
                            await this.db.addUser(googleUser);
                        }
                        
                        await this.completeLogin(googleUser);
                        this.showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø­Ø³Ø§Ø¨ Google Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                    } catch (error) {
                        this.showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„', 'error');
                    }
                }, 1500);
            }

            async googleRegister() {
                this.googleLogin(); // Ù†ÙØ³ ÙˆØ¸ÙŠÙØ© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            }

            async completeLogin(user) {
                this.currentUser = user;
                localStorage.setItem('circl_current_user', JSON.stringify(user));
                
                // Ø¥Ø®ÙØ§Ø¡ Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
                document.getElementById('authOverlay').style.display = 'none';
                
                // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
                await this.startApp();
                
                this.showNotification(`Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ${user.username}!`, 'success');
            }

            async startApp() {
                // Ø¥Ø¸Ù‡Ø§Ø± ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
                document.getElementById('chatContainer').style.display = 'flex';
                
                // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                this.updateUserProfile();
                
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØºØ±Ù
                await this.loadRooms();
                
                // Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„ØºØ±ÙØ© Ø§Ù„Ø¹Ø§Ù…Ø©
                await this.joinRoom('room-1');
                
                // Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±
                this.connectToSocket();
                
                // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ù„Ù„Ù…Ø´Ø±ÙÙŠÙ† ÙˆØ§Ù„Ù…Ø§Ù„Ùƒ
                if (['owner', 'admin'].includes(this.currentUser.role)) {
                    document.getElementById('adminBtn').style.display = 'block';
                }
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¬Ù„Ø³Ø© Ø«ÙŠØ±Ø§Ø¨ÙŠØ³Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
                await this.checkDailyTherapistSession();
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…ØªØ¬Ø§ÙˆØ¨
                this.handleResponsiveDesign();
            }

            updateUserProfile() {
                document.getElementById('userDisplayName').textContent = this.currentUser.username;
                document.getElementById('userAvatarImg').src = this.currentUser.avatar;
                document.getElementById('userRole').textContent = this.getRoleText(this.currentUser.role);
                document.getElementById('userRole').className = `user-role role-${this.currentUser.role}`;
                
                // ØªØ­Ø¯ÙŠØ« Ø´Ø§Ø±Ø© Ø§Ù„ØªØ­Ù‚Ù‚
                if (this.currentUser.verified) {
                    document.getElementById('verifiedBadge').style.display = 'inline';
                }
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ÙˆØ§Ù„Ù†Ù‚Ø§Ø·
                this.updateLevelInfo();
            }

            getRoleText(role) {
                const roles = {
                    'owner': 'Ù…Ø§Ù„Ùƒ',
                    'admin': 'Ù…Ø´Ø±Ù',
                    'moderator': 'Ù…Ø±Ø§Ù‚Ø¨',
                    'vip': 'VIP',
                    'user': 'Ù…Ø³ØªØ®Ø¯Ù…'
                };
                return roles[role] || 'Ù…Ø³ØªØ®Ø¯Ù…';
            }

            updateLevelInfo() {
                const level = this.currentUser.level || 1;
                const points = this.currentUser.points || 0;
                const currentLevelPoints = points % 100;
                const progress = (currentLevelPoints / 100) * 100;
                
                document.getElementById('userLevel').textContent = level;
                document.getElementById('userRank').textContent = this.getRankFromLevel(level);
                document.getElementById('levelProgress').style.width = `${progress}%`;
                document.getElementById('currentXP').textContent = `${points} XP`;
                document.getElementById('nextLevelXP').textContent = `${(level * 100)} XP`;
            }

            getRankFromLevel(level) {
                if (level >= 50) return 'Ù…Ù„Ùƒ';
                if (level >= 40) return 'Ù…Ø§Ø³ÙŠ';
                if (level >= 30) return 'Ø°Ù‡Ø¨ÙŠ';
                if (level >= 20) return 'ÙØ¶ÙŠ';
                if (level >= 10) return 'Ø¨Ø±ÙˆÙ†Ø²ÙŠ';
                return 'Ù…Ø¨ØªØ¯Ø¦';
            }

            async loadRooms() {
                try {
                    const rooms = await this.db.getAllRooms();
                    
                    // ØªØ±ØªÙŠØ¨ Ø§Ù„ØºØ±Ù Ø­Ø³Ø¨ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©
                    rooms.sort((a, b) => a.order - b.order);
                    
                    const roomList = document.getElementById('roomList');
                    roomList.innerHTML = '';
                    
                    for (const room of rooms) {
                        const li = document.createElement('li');
                        li.className = 'room-item';
                        if (this.currentRoom && room.id === this.currentRoom.id) {
                            li.classList.add('active');
                        }
                        
                        li.innerHTML = `
                            <i class="fas ${room.icon} room-icon"></i>
                            <div class="room-info">
                                <div class="room-name">${room.name}</div>
                                <div class="room-stats">
                                    <span>${room.description}</span>
                                </div>
                            </div>
                            ${room.type === 'vip' ? '<i class="fas fa-lock" style="color: var(--vip);"></i>' : ''}
                        `;
                        
                        li.addEventListener('click', () => this.joinRoom(room.id));
                        roomList.appendChild(li);
                    }
                    
                    document.getElementById('roomsCount').textContent = rooms.length;
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØºØ±Ù:', error);
                }
            }

            async joinRoom(roomId) {
                try {
                    const room = await this.db.getRoom(roomId);
                    if (!room) {
                        this.showNotification('Ø§Ù„ØºØ±ÙØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©', 'error');
                        return;
                    }

                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ØºØ±ÙØ© VIP
                    if (room.type === 'vip' && !['owner', 'admin', 'vip'].includes(this.currentUser.role)) {
                        this.showVipModal(room);
                        return;
                    }

                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØºØ±ÙØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                    this.currentRoom = room;
                    
                    // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                    document.getElementById('currentRoomTitle').textContent = room.name;
                    document.getElementById('currentRoomDesc').textContent = room.description;
                    document.getElementById('roomIcon').className = `fas ${room.icon}`;
                    
                    // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØºØ±Ù
                    await this.loadRooms();
                    
                    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
                    await this.loadMessages();
                    
                    // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ†
                    await this.loadActiveUsers();
                    
                    // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª ØºØ±ÙØ© Ø«ÙŠØ±Ø§Ø¨ÙŠØ³ØªØŒ Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ÙŠØ©
                    if (room.type === 'therapist') {
                        await this.handleTherapistRoom();
                    }
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„ØºØ±ÙØ©:', error);
                    this.showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„ØºØ±ÙØ©', 'error');
                }
            }

            showVipModal(room) {
                window.currentVipRoom = room;
                document.getElementById('vipModal').classList.add('active');
            }

            async enterVipRoom() {
                const password = document.getElementById('vipPassword').value;
                const room = window.currentVipRoom;
                
                if (password === room.password) {
                    // ØªØ±Ù‚ÙŠØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ù„Ù‰ VIP
                    await this.db.updateUser(this.currentUser.id, { role: 'vip' });
                    this.currentUser.role = 'vip';
                    this.updateUserProfile();
                    
                    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© ÙˆØ§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ØºØ±ÙØ©
                    this.closeVipModal();
                    await this.joinRoom(room.id);
                    this.showNotification('ØªÙ… ØªØ±Ù‚ÙŠØªÙƒ Ø¥Ù„Ù‰ Ø¹Ø¶Ùˆ VIP!', 'success');
                } else {
                    this.showNotification('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
                }
            }

            closeVipModal() {
                document.getElementById('vipModal').classList.remove('active');
                document.getElementById('vipPassword').value = '';
            }

            async loadMessages() {
                try {
                    const messages = await this.db.getRoomMessages(this.currentRoom.id);
                    const container = document.getElementById('messagesContainer');
                    container.innerHTML = '';
                    
                    if (messages.length === 0) {
                        container.innerHTML = `
                            <div style="text-align: center; padding: 3rem; color: #6b7280;">
                                <i class="fas fa-comments" style="font-size: 4rem; opacity: 0.3; margin-bottom: 1rem;"></i>
                                <h3 style="margin-bottom: 0.5rem; color: #111827;">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ ${this.currentRoom.name}!</h3>
                                <p>ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠØ±Ø³Ù„ Ø±Ø³Ø§Ù„Ø© ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ØºØ±ÙØ©</p>
                            </div>
                        `;
                        return;
                    }
                    
                    for (const message of messages) {
                        await this.displayMessage(message);
                    }
                    
                    // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù„Ø¢Ø®Ø± Ø±Ø³Ø§Ù„Ø©
                    container.scrollTop = container.scrollHeight;
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„:', error);
                }
            }

            async displayMessage(message) {
                const container = document.getElementById('messagesContainer');
                const isCurrentUser = message.userId === this.currentUser.id;
                const user = await this.db.getUserById(message.userId);
                
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${isCurrentUser ? 'my-message' : ''}`;
                
                const time = new Date(message.timestamp).toLocaleTimeString('ar-EG', {
                    hour: '2-digit',
                    minute: '2-digit'
                });

                const roleBadge = user?.role && user.role !== 'user' ? 
                    `<span class="badge badge-${user.role}">${this.getRoleText(user.role)}</span>` : '';
                
                messageDiv.innerHTML = `
                    ${!isCurrentUser ? `
                        <div class="message-avatar">
                            <img src="${user?.avatar || 'https://api.dicebear.com/7.x/avataaars/svg?seed=user'}" alt="${user?.username || 'Ù…Ø³ØªØ®Ø¯Ù…'}">
                        </div>
                    ` : ''}
                    
                    <div class="message-content">
                        <div class="message-header">
                            <div class="message-sender">
                                ${roleBadge}
                                ${user?.username || 'Ù…Ø³ØªØ®Ø¯Ù…'}
                                ${user?.verified ? '<i class="fas fa-check-circle badge-verified"></i>' : ''}
                            </div>
                            <div class="message-time">${time}</div>
                        </div>
                        <div class="message-text">${this.escapeHtml(message.text)}</div>
                    </div>
                    
                    ${isCurrentUser ? `
                        <div class="message-avatar">
                            <img src="${this.currentUser.avatar}" alt="${this.currentUser.username}">
                        </div>
                    ` : ''}
                `;
                
                container.appendChild(messageDiv);
                container.scrollTop = container.scrollHeight;
            }

            async sendMessage() {
                const input = document.getElementById('messageInput');
                const text = input.value.trim();
                
                if (!text || !this.currentRoom || !this.currentUser) return;

                try {
                    // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª ØºØ±ÙØ© Ø«ÙŠØ±Ø§Ø¨ÙŠØ³ØªØŒ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø®Ø§ØµØ©
                    if (this.currentRoom.type === 'therapist') {
                        await this.handleTherapistMessage(text);
                        input.value = '';
                        return;
                    }

                    const message = {
                        id: `msg-${Date.now()}`,
                        roomId: this.currentRoom.id,
                        userId: this.currentUser.id,
                        username: this.currentUser.username,
                        avatar: this.currentUser.avatar,
                        text: text,
                        timestamp: new Date().toISOString(),
                        type: 'text'
                    };

                    await this.db.addMessage(message);
                    await this.displayMessage(message);
                    input.value = '';
                    
                    // Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø§Ø· Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
                    await this.addUserPoints(5);
                    
                    // Ø¥Ø®ÙØ§Ø¡ Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø©
                    this.clearTyping();
                    
                    // Ù…Ø­Ø§ÙƒØ§Ø© Ø±Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†
                    if (Math.random() > 0.7) {
                        setTimeout(() => this.simulateResponse(), 2000);
                    }
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©:', error);
                    this.showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©', 'error');
                }
            }

            async handleTherapistRoom() {
                const container = document.getElementById('messagesContainer');
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¬Ù„Ø³Ø© Ø§Ù„ÙŠÙˆÙ…
                const todayTicket = await this.db.getTodayTicket(this.currentUser.id);
                
                if (todayTicket) {
                    // Ø¹Ø±Ø¶ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¬Ù„Ø³Ø©
                    container.innerHTML += `
                        <div style="text-align: center; margin: 1rem 0;">
                            <div style="display: inline-block; background: #f3f4f6; padding: 0.5rem 1rem; border-radius: var(--radius); color: #6b7280; font-size: 0.875rem;">
                                <i class="fas fa-calendar-alt"></i>
                                Ø¬Ù„Ø³Ø© Ø§Ù„ÙŠÙˆÙ… - ${new Date(todayTicket.createdAt).toLocaleDateString('ar-EG')}
                            </div>
                        </div>
                    `;
                }
                
                // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ Ù…Ù† Ø§Ù„Ø¨ÙˆØª
                const welcomeMessage = {
                    id: `msg-${Date.now()}`,
                    roomId: this.currentRoom.id,
                    userId: 'therapist-bot',
                    username: 'ğŸ§  Ø«ÙŠØ±Ø§Ø¨ÙŠØ³Øª AI',
                    avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=therapist&backgroundColor=8b5cf6',
                    text: 'Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ Ù„Ù„Ø¯Ø¹Ù… Ø§Ù„Ù†ÙØ³ÙŠ. ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ',
                    timestamp: new Date().toISOString(),
                    type: 'system'
                };
                
                await this.db.addMessage(welcomeMessage);
                await this.displayMessage(welcomeMessage);
            }

            async handleTherapistMessage(userMessage) {
                try {
                    // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                    const userMsg = {
                        id: `msg-${Date.now()}`,
                        roomId: this.currentRoom.id,
                        userId: this.currentUser.id,
                        username: this.currentUser.username,
                        avatar: this.currentUser.avatar,
                        text: userMessage,
                        timestamp: new Date().toISOString(),
                        type: 'text'
                    };

                    await this.db.addMessage(userMsg);
                    await this.displayMessage(userMsg);

                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¬Ù„Ø³Ø© Ø§Ù„ÙŠÙˆÙ… Ø£Ùˆ Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙŠØ¯Ø©
                    let ticket = await this.db.getTodayTicket(this.currentUser.id);
                    if (!ticket) {
                        ticket = await this.db.createTicket(this.currentUser.id, userMessage);
                    }

                    // ØªÙˆÙ„ÙŠØ¯ Ø±Ø¯ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
                    this.showNotification('Ø¬Ø§Ø±Ù ØªØ­Ù„ÙŠÙ„ Ø±Ø³Ø§Ù„ØªÙƒ...', 'info');
                    const aiResponse = await this.therapistAI.generateResponse(userMessage);
                    
                    // Ø¥Ø¶Ø§ÙØ© Ø±Ø¯ Ø§Ù„Ø¨ÙˆØª
                    const botMessage = {
                        id: `msg-${Date.now()}`,
                        roomId: this.currentRoom.id,
                        userId: 'therapist-bot',
                        username: 'ğŸ§  Ø«ÙŠØ±Ø§Ø¨ÙŠØ³Øª AI',
                        avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=therapist&backgroundColor=8b5cf6',
                        text: aiResponse,
                        timestamp: new Date().toISOString(),
                        type: 'system'
                    };

                    await this.db.addMessage(botMessage);
                    await this.db.addTicketResponse(ticket.id, {
                        from: 'bot',
                        message: aiResponse
                    });

                    await this.displayMessage(botMessage);
                    await this.addUserPoints(10);
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø«ÙŠØ±Ø§Ø¨ÙŠØ³Øª:', error);
                }
            }

            async checkDailyTherapistSession() {
                const todayTicket = await this.db.getTodayTicket(this.currentUser.id);
                if (!todayTicket) {
                    // Ø¹Ø±Ø¶ Ø¥Ø´Ø¹Ø§Ø± Ù„Ø¬Ù„Ø³Ø© Ø§Ù„ÙŠÙˆÙ…
                    setTimeout(() => {
                        this.showNotification('ğŸ’†â€â™€ï¸ Ø¬Ù„Ø³Ø© Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ù†ÙØ³ÙŠ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ù…ØªØ§Ø­Ø©! Ù‚Ù… Ø¨Ø²ÙŠØ§Ø±Ø© ØºØ±ÙØ© Ø§Ù„Ø«ÙŠØ±Ø§Ø¨ÙŠØ³Øª', 'info');
                    }, 5000);
                }
            }

            async simulateResponse() {
                try {
                    const rooms = await this.db.getAllRooms();
                    const currentRoomUsers = rooms.find(r => r.id === this.currentRoom.id)?.users || [];
                    
                    if (currentRoomUsers.length < 2) return;
                    
                    const responses = [
                        'Ø£Ù‡Ù„Ø§Ù‹! ÙƒÙŠÙ Ø­Ø§Ù„ÙƒØŸ',
                        'Ø´ÙƒØ±Ø§Ù‹ Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©',
                        'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…ÙÙŠØ¯Ø©',
                        'Ø£ÙˆØ§ÙÙ‚Ùƒ Ø§Ù„Ø±Ø£ÙŠ',
                        'ğŸ˜Š Ø£Ø­Ø¨ Ù‡Ø°Ø§ Ø§Ù„Ù†Ù‚Ø§Ø´',
                        'Ù‡Ù„ Ù„Ø¯Ù‰ Ø£Ø­Ø¯ ØªØ¬Ø±Ø¨Ø© Ù…Ø¹ Ù‡Ø°Ø§ØŸ'
                    ];
                    
                    const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                    
                    // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© ÙˆÙ‡Ù…ÙŠØ©
                    const fakeMessage = {
                        id: `msg-${Date.now()}`,
                        roomId: this.currentRoom.id,
                        userId: 'fake-user',
                        username: 'Ù…Ø³ØªØ®Ø¯Ù…',
                        avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=user' + Math.random(),
                        text: randomResponse,
                        timestamp: new Date().toISOString(),
                        type: 'text'
                    };

                    await this.db.addMessage(fakeMessage);
                    await this.displayMessage(fakeMessage);
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø±Ø¯:', error);
                }
            }

            async addUserPoints(points) {
                if (!this.currentUser) return;
                
                try {
                    this.currentUser.points = (this.currentUser.points || 0) + points;
                    this.currentUser.level = Math.floor(this.currentUser.points / 100) + 1;
                    
                    await this.db.updateUser(this.currentUser.id, {
                        points: this.currentUser.points,
                        level: this.currentUser.level
                    });
                    
                    this.updateLevelInfo();
                    
                    if (points >= 10) {
                        this.showNotification(`ğŸ‰ +${points} Ù†Ù‚Ø·Ø©!`, 'success');
                    }
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Ù‚Ø§Ø·:', error);
                }
            }

            async loadActiveUsers() {
                try {
                    const users = await this.db.getAllUsers();
                    const userList = document.getElementById('userList');
                    userList.innerHTML = '';
                    
                    // Ø¹Ø±Ø¶ 10 Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¹Ø´ÙˆØ§Ø¦ÙŠÙŠÙ† ÙƒÙ†Ø´Ø·ÙŠÙ†
                    const activeUsers = users
                        .filter(u => u.id !== this.currentUser.id)
                        .sort(() => Math.random() - 0.5)
                        .slice(0, 10);
                    
                    for (const user of activeUsers) {
                        const li = document.createElement('li');
                        li.className = 'user-list-item';
                        li.innerHTML = `
                            <div class="user-list-avatar">
                                <img src="${user.avatar}" alt="${user.username}">
                            </div>
                            <div style="flex: 1;">
                                <div style="font-weight: 500; font-size: 0.875rem;">${user.username}</div>
                                <div style="font-size: 0.75rem; color: #9ca3af;">${this.getRoleText(user.role)}</div>
                            </div>
                        `;
                        userList.appendChild(li);
                    }
                    
                    document.getElementById('onlineCount').textContent = activeUsers.length + 1; // +1 Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†:', error);
                }
            }

            signalTyping() {
                if (!this.currentRoom || !this.currentUser) return;
                
                // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø©
                document.getElementById('typingIndicator').style.display = 'block';
                document.getElementById('typingUser').textContent = this.currentUser.username;
                
                // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ø¤Ø´Ø± Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†
                clearTimeout(this.typingTimeout);
                this.typingTimeout = setTimeout(() => {
                    document.getElementById('typingIndicator').style.display = 'none';
                }, 3000);
            }

            clearTyping() {
                document.getElementById('typingIndicator').style.display = 'none';
                clearTimeout(this.typingTimeout);
            }

            connectToSocket() {
                // Ù…Ø­Ø§ÙƒØ§Ø© Ø§ØªØµØ§Ù„ Ø§Ù„Ø³ÙˆÙƒÙŠØª
                this.showNotification('Ø¬Ø§Ø±Ù Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±...', 'info');
                
                setTimeout(() => {
                    this.socket = {
                        emit: (event, data) => console.log('Socket emit:', event, data),
                        on: (event, callback) => {
                            if (event === 'message') {
                                // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
                                setInterval(() => {
                                    if (Math.random() > 0.8) {
                                        this.simulateIncomingMessage();
                                    }
                                }, 10000);
                            }
                        }
                    };
                    
                    this.showNotification('ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                }, 1500);
            }

            async simulateIncomingMessage() {
                if (!this.currentRoom || this.currentRoom.type === 'therapist') return;
                
                const responses = [
                    'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø§Ù„Ø¬Ù…ÙŠØ¹!',
                    'ÙƒÙŠÙ Ø§Ù„Ø­Ø§Ù„ØŸ',
                    'Ø£ÙŠ Ø£Ø­Ø¯ Ù‡Ù†Ø§ØŸ',
                    'Ù…ÙˆØ¶ÙˆØ¹ Ø´ÙŠÙ‚',
                    'ğŸ’¬'
                ];
                
                const fakeMessage = {
                    id: `msg-${Date.now()}`,
                    roomId: this.currentRoom.id,
                    userId: 'fake-' + Date.now(),
                    username: 'Ù…Ø³ØªØ®Ø¯Ù…',
                    avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=' + Date.now(),
                    text: responses[Math.floor(Math.random() * responses.length)],
                    timestamp: new Date().toISOString(),
                    type: 'text'
                };

                await this.db.addMessage(fakeMessage);
                await this.displayMessage(fakeMessage);
            }

            async openAdminPanel() {
                document.getElementById('adminPanel').classList.add('active');
                await this.loadAdminUsers();
            }

            closeAdminPanel() {
                document.getElementById('adminPanel').classList.remove('active');
            }

            async loadAdminUsers() {
                try {
                    const users = await this.db.getAllUsers();
                    const container = document.getElementById('adminUsersList');
                    container.innerHTML = '';
                    
                    for (const user of users) {
                        const div = document.createElement('div');
                        div.className = 'user-admin-item';
                        div.style.cssText = `
                            padding: 1rem;
                            border: 1px solid #e5e7eb;
                            border-radius: var(--radius);
                            margin-bottom: 0.5rem;
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                        `;
                        
                        div.innerHTML = `
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <img src="${user.avatar}" style="width: 48px; height: 48px; border-radius: 50%;">
                                <div>
                                    <div style="font-weight: 600;">${user.username}</div>
                                    <div style="font-size: 0.875rem; color: #6b7280;">
                                        ${this.getRoleText(user.role)} â€¢ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${user.level}
                                    </div>
                                </div>
                            </div>
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="btn" onclick="app.promoteUser('${user.id}')" 
                                        style="background: #f3f4f6; padding: 0.5rem 1rem; font-size: 0.875rem;"
                                        ${this.currentUser.role !== 'owner' ? 'disabled' : ''}>
                                    ØªØ±Ù‚ÙŠØ©
                                </button>
                                <button class="btn" onclick="app.addPointsToUser('${user.id}')"
                                        style="background: var(--info); color: white; padding: 0.5rem 1rem; font-size: 0.875rem;"
                                        ${!['owner', 'admin'].includes(this.currentUser.role) ? 'disabled' : ''}>
                                    Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø§Ø·
                                </button>
                            </div>
                        `;
                        
                        container.appendChild(div);
                    }
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©:', error);
                }
            }

            async loadAdminRooms() {
                try {
                    const rooms = await this.db.getAllRooms();
                    const container = document.getElementById('adminRoomsList');
                    container.innerHTML = '';
                    
                    for (const room of rooms) {
                        const div = document.createElement('div');
                        div.style.cssText = `
                            padding: 1rem;
                            border: 1px solid #e5e7eb;
                            border-radius: var(--radius);
                            margin-bottom: 0.5rem;
                        `;
                        
                        div.innerHTML = `
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <div style="font-weight: 600;">${room.name}</div>
                                <span style="background: ${room.type === 'public' ? 'var(--primary)' : 
                                                          room.type === 'vip' ? 'var(--vip)' : 
                                                          'var(--therapist)'}; 
                                       color: white; padding: 0.25rem 0.75rem; border-radius: 50px; font-size: 0.75rem;">
                                    ${room.type === 'public' ? 'Ø¹Ø§Ù…Ø©' : 
                                      room.type === 'vip' ? 'VIP' : 'Ø«Ø±Ø§Ø¨ÙŠØ³Øª'}
                                </span>
                            </div>
                            <div style="color: #6b7280; font-size: 0.875rem; margin-bottom: 0.5rem;">${room.description}</div>
                            <div style="font-size: 0.875rem;">
                                <span style="color: #6b7280;">Ø§Ù„ØªØ±ØªÙŠØ¨:</span> ${room.order}
                            </div>
                        `;
                        
                        container.appendChild(div);
                    }
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØºØ±Ù Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©:', error);
                }
            }

            async promoteUser(userId) {
                if (this.currentUser.role !== 'owner') {
                    this.showNotification('Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„ØªØ±Ù‚ÙŠØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†', 'error');
                    return;
                }

                try {
                    const user = await this.db.getUserById(userId);
                    if (!user) return;

                    const roles = ['user', 'vip', 'moderator', 'admin'];
                    const currentIndex = roles.indexOf(user.role);
                    const nextRole = roles[Math.min(currentIndex + 1, roles.length - 1)];
                    
                    if (confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ±Ù‚ÙŠØ© ${user.username} Ø¥Ù„Ù‰ ${this.getRoleText(nextRole)}ØŸ`)) {
                        await this.db.updateUser(userId, { role: nextRole });
                        this.showNotification(`ØªÙ… ØªØ±Ù‚ÙŠØ© ${user.username} Ø¥Ù„Ù‰ ${this.getRoleText(nextRole)}`, 'success');
                        await this.loadAdminUsers();
                    }
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ±Ù‚ÙŠØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', error);
                    this.showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ±Ù‚ÙŠØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'error');
                }
            }

            async addPointsToUser(userId) {
                if (!['owner', 'admin'].includes(this.currentUser.role)) {
                    this.showNotification('Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Ù‚Ø§Ø·', 'error');
                    return;
                }

                try {
                    const user = await this.db.getUserById(userId);
                    if (!user) return;

                    const points = parseInt(prompt(`Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø· Ù„Ø¥Ø¶Ø§ÙØªÙ‡Ø§ Ù„Ù€ ${user.username}:`));
                    if (isNaN(points) || points <= 0) {
                        this.showNotification('Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø· ØºÙŠØ± ØµØ§Ù„Ø­', 'error');
                        return;
                    }

                    const newPoints = (user.points || 0) + points;
                    await this.db.updateUser(userId, { points: newPoints });
                    
                    this.showNotification(`ØªÙ… Ø¥Ø¶Ø§ÙØ© ${points} Ù†Ù‚Ø·Ø© Ù„Ù€ ${user.username}`, 'success');
                    await this.loadAdminUsers();
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Ù‚Ø§Ø·:', error);
                    this.showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Ù‚Ø§Ø·', 'error');
                }
            }

            filterAdminUsers(searchTerm) {
                const items = document.querySelectorAll('.user-admin-item');
                items.forEach(item => {
                    const username = item.querySelector('div > div:nth-child(2) > div:nth-child(1)').textContent.toLowerCase();
                    if (username.includes(searchTerm.toLowerCase())) {
                        item.style.display = 'flex';
                    } else {
                        item.style.display = 'none';
                    }
                });
            }

            handleResponsiveDesign() {
                const mobileMenuBtn = document.getElementById('mobileMenuBtn');
                if (window.innerWidth <= 768) {
                    mobileMenuBtn.style.display = 'block';
                    document.getElementById('sidebar').classList.remove('active');
                } else {
                    mobileMenuBtn.style.display = 'none';
                    document.getElementById('sidebar').classList.add('active');
                }
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.textContent = message;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.animation = 'slideUp 0.3s ease';
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
                
                // Ø¥Ø¶Ø§ÙØ© Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„Ø¥Ø®ÙØ§Ø¡
                if (!document.querySelector('#notification-styles')) {
                    const style = document.createElement('style');
                    style.id = 'notification-styles';
                    style.textContent = `
                        @keyframes slideUp {
                            from { top: 20px; opacity: 1; }
                            to { top: -100px; opacity: 0; }
                        }
                    `;
                    document.head.appendChild(style);
                }
            }

            logout() {
                this.currentUser = null;
                this.currentRoom = null;
                localStorage.removeItem('circl_current_user');
                
                document.getElementById('chatContainer').style.display = 'none';
                document.getElementById('authOverlay').style.display = 'flex';
                
                this.showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'info');
            }
        }

        // ========== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ==========
        let app;

        document.addEventListener('DOMContentLoaded', () => {
            app = new ChatApp();
            
            // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„ÙˆØµÙˆÙ„ Ù…Ù† Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            window.app = app;
            window.enterVipRoom = () => app.enterVipRoom();
            window.closeVipModal = () => app.closeVipModal();
            window.closeAdminPanel = () => app.closeAdminPanel();
        });

        // Ø¥Ø¶Ø§ÙØ© Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        document.addEventListener('DOMContentLoaded', () => {
            const logoutBtn = document.createElement('button');
            logoutBtn.innerHTML = '<i class="fas fa-sign-out-alt"></i>';
            logoutBtn.style.cssText = `
                position: fixed;
                bottom: 20px;
                left: 20px;
                width: 50px;
                height: 50px;
                border-radius: 50%;
                background: var(--danger);
                color: white;
                border: none;
                cursor: pointer;
                z-index: 1000;
                display: none;
            `;
            logoutBtn.onclick = () => app.logout();
            document.body.appendChild(logoutBtn);

            // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¹Ù†Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            const observer = new MutationObserver(() => {
                if (document.getElementById('chatContainer').style.display !== 'none') {
                    logoutBtn.style.display = 'block';
                } else {
                    logoutBtn.style.display = 'none';
                }
            });

            observer.observe(document.getElementById('chatContainer'), {
                attributes: true,
                attributeFilter: ['style']
            });
        });
    </script>
</body>
</html>
